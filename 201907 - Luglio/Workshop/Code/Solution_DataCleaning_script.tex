\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Solution Data Cleaning},
            pdfauthor={Giovanna de Vincenzo},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Solution Data Cleaning}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Giovanna de Vincenzo}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{23 luglio, 2019}


\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\subsection{Load required packages}\label{load-required-packages}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readr)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(stringr)}
\KeywordTok{library}\NormalTok{(reshape)}
\end{Highlighting}
\end{Shaded}

\subsection{Import dataset}\label{import-dataset}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"Farmers_Markets.csv"}\NormalTok{)}
\KeywordTok{class}\NormalTok{(markets) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "data.frame"
\end{verbatim}

\subsection{Inspect your data}\label{inspect-your-data}

First six rows of dataset

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        Ã¯..X        Y OBJECTID                        NEIGHBORHOOD
## 1 -75.12156 39.97843        1 Bridesburg Kensington Port Richmond
## 2 -75.13365 39.98297        2 Bridesburg Kensington Port Richmond
## 3 -75.10947 39.98255        3 Bridesburg Kensington Port Richmond
## 4 -75.17067 39.95014        4                         Center City
## 5 -75.18114 39.94902        5                        Center City 
## 6 -75.17399 39.96732        6                         Center City
##                                 NAME                        ADDRESS
## 1              Greensgrow Farm Stand         2501 E. Cumberland Ave
## 2 Norris Square Neighborhood Project              2141 N. Howard St
## 3                        Powers Park           Almond and E. Ann St
## 4                        Rittenhouse            18th and Walnut St.
## 5              Schuylkill River Park             25th and Spruce St
## 6                          Fairmount N. 22nd St. and Fairmount Ave.
##                           ADDRESS_NOTES        DAY
## 1                                          Mon-Sun
## 2 Between Norris St and Susquehanna Ave        Wed
## 3                                            Thurs
## 4                                       Tues & Sat
## 5                                              Wed
## 6                                            Thurs
##                                  TIME
## 1 Mon-Fri 10am-5pm, Sat-Sun 10am-4pm 
## 2                            11am-1pm
## 3                               3-7pm
## 4          Tues 10am-2pm, Sat 9am-3pm
## 5                               3-7pm
## 6                               3-7pm
##                                    MONTHS ACCEPT_SNAP_ACCESS ACCEPT_FMNP
## 1                     Late May - November                  Y           Y
## 2                          May - November            Applied     Applied
## 3                         May - November                               Y
## 4 Tues- June - November; Sat- Year round                               Y
## 5                 May 17th - late October                              Y
## 6                     June 1st - November                  Y           Y
##   ACCEPT_PHILLY_FOOD_BUCKS_ MAJOR_BUS_SUBWAY_ROUTES
## 1                        NA          25, 39, 43, 89
## 2                        NA               3, 39, 89
## 3                        NA             15B, 54, 60
## 4                        NA                   9, 17
## 5                        NA               7, 12, 40
## 6                        NA   7, 32, 33, 48, PHLASH
\end{verbatim}

Variable names

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Ã¯..X"                      "Y"                        
##  [3] "OBJECTID"                  "NEIGHBORHOOD"             
##  [5] "NAME"                      "ADDRESS"                  
##  [7] "ADDRESS_NOTES"             "DAY"                      
##  [9] "TIME"                      "MONTHS"                   
## [11] "ACCEPT_SNAP_ACCESS"        "ACCEPT_FMNP"              
## [13] "ACCEPT_PHILLY_FOOD_BUCKS_" "MAJOR_BUS_SUBWAY_ROUTES"
\end{verbatim}

Dimensions of data frame

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 54 14
\end{verbatim}

How many NAs do we have per variable

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       Ã¯..X              Y            OBJECTID    
##  Min.   :-75.25   Min.   :39.92   Min.   : 1.00  
##  1st Qu.:-75.21   1st Qu.:39.95   1st Qu.:14.25  
##  Median :-75.17   Median :39.98   Median :27.50  
##  Mean   :-75.17   Mean   :39.98   Mean   :27.50  
##  3rd Qu.:-75.15   3rd Qu.:40.01   3rd Qu.:40.75  
##  Max.   :-75.04   Max.   :40.07   Max.   :54.00  
##                                                  
##                    NEIGHBORHOOD                 NAME   
##  North                   : 9    11th & Dauphin    : 1  
##  Center City             : 8    22nd & Tasker     : 1  
##  West                    : 6    26th and Allegheny: 1  
##  West                    : 6    33rd & Diamond    : 1  
##  South                   : 5    42nd and Girard   : 1  
##  Germantown Chestnut Hill: 4    4th and Lehigh    : 1  
##  (Other)                 :16    (Other)           :48  
##                     ADDRESS                                ADDRESS_NOTES
##  12th and Arch St       : 2                                       :38   
##  10th and Chestnut St.  : 1   At Saul High School                 : 1   
##  18th and Walnut St.    : 1   At the entrance to Bartram's Garden : 1   
##  2141 N. Howard St      : 1   At the Overbrook Presbyterian Church: 1   
##  2144 Cecil B. Moore Ave: 1   At the West Philly YMCA             : 1   
##  215 E. Penn St         : 1   Between 49th and 50th Streets       : 1   
##  (Other)                :47   (Other)                             :11   
##              DAY           TIME                MONTHS  
##  Sat           :12   2-6pm   :10   May - November : 4  
##  Wed           :11   10am-2pm: 8                  : 3  
##  Thurs         : 9   3-7pm   : 6   May - November : 3  
##  Tues          : 5   1-5pm   : 2   May- November  : 2  
##  Mon - Sat, Sun: 2   11am-2pm: 2   Open year round: 2  
##  Sun           : 2   11am-3pm: 2   Year round     : 2  
##  (Other)       :13   (Other) :24   (Other)        :38  
##     ACCEPT_SNAP_ACCESS  ACCEPT_FMNP ACCEPT_PHILLY_FOOD_BUCKS_
##              :11              : 7   Mode:logical             
##              : 1       Applied: 1   NA's:54                  
##  Applied     : 1       Y      :46                            
##  McCanns Farm: 1                                             
##  Y           :39                                             
##  Y           : 1                                             
##                                                              
##   MAJOR_BUS_SUBWAY_ROUTES
##               : 4        
##  23           : 2        
##  7, 12, 40    : 2        
##  12, 40, 57   : 1        
##  13 trolley, G: 1        
##  13, 30, 34   : 1        
##  (Other)      :43
\end{verbatim}

Data-viewer

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{View}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

Display internal structure

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(markets) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    54 obs. of  14 variables:
##  $ Ã¯..X                     : num  -75.1 -75.1 -75.1 -75.2 -75.2 ...
##  $ Y                        : num  40 40 40 40 39.9 ...
##  $ OBJECTID                 : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ NEIGHBORHOOD             : Factor w/ 16 levels "Bridesburg Kensington Port Richmond",..: 1 1 1 3 4 3 3 3 3 3 ...
##  $ NAME                     : Factor w/ 54 levels "11th & Dauphin",..: 23 39 44 47 49 17 32 18 27 46 ...
##  $ ADDRESS                  : Factor w/ 53 levels "10th and Chestnut St.",..: 9 4 37 3 11 47 1 8 14 2 ...
##  $ ADDRESS_NOTES            : Factor w/ 17 levels "","At Saul High School",..: 1 7 1 1 1 1 1 1 1 1 ...
##  $ DAY                      : Factor w/ 19 levels "1st & 3rd Fri",..: 8 19 13 16 19 13 13 11 12 9 ...
##  $ TIME                     : Factor w/ 27 levels "1-5pm","10am-2pm",..: 22 5 14 27 14 14 7 20 2 23 ...
##  $ MONTHS                   : Factor w/ 44 levels "","July - Sept",..: 21 26 27 43 32 16 27 40 40 44 ...
##  $ ACCEPT_SNAP_ACCESS       : Factor w/ 6 levels ""," ","Applied",..: 5 3 1 1 2 5 4 5 5 5 ...
##  $ ACCEPT_FMNP              : Factor w/ 3 levels "","Applied","Y": 3 2 3 3 3 3 3 3 3 3 ...
##  $ ACCEPT_PHILLY_FOOD_BUCKS_: logi  NA NA NA NA NA NA ...
##  $ MAJOR_BUS_SUBWAY_ROUTES  : Factor w/ 49 levels "","12, 40, 57",..: 15 18 6 41 37 38 48 37 2 23 ...
\end{verbatim}

\subsection{Dealing with missing
values}\label{dealing-with-missing-values}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#replace blanks/spaces with NAs}
\NormalTok{markets[markets}\OperatorTok{==}\StringTok{""}\OperatorTok{|}\StringTok{ }\NormalTok{markets}\OperatorTok{==}\StringTok{" "}\NormalTok{] =}\StringTok{ }\OtherTok{NA}

\CommentTok{#for factor variables:}
\NormalTok{markets <-}\StringTok{ }\NormalTok{markets }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate_if}\NormalTok{(is.factor, }\KeywordTok{funs}\NormalTok{(}\KeywordTok{factor}\NormalTok{(}\KeywordTok{replace}\NormalTok{(., .}\OperatorTok{==}\StringTok{""} \OperatorTok{|}\StringTok{ }\NormalTok{.}\OperatorTok{==}\StringTok{" "}\NormalTok{, }\OtherTok{NA}\NormalTok{))))}

\CommentTok{#Question: What do you do when there are text NAs where actual NAs should be?}

\NormalTok{markets[markets}\OperatorTok{==}\StringTok{"NA"}\NormalTok{]<-}\OtherTok{NA}
\end{Highlighting}
\end{Shaded}

We can solve all of the problems above by changing the arguments when
importing data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"Farmers_Markets.csv"}\NormalTok{, }\DataTypeTok{na.strings=}\KeywordTok{c}\NormalTok{(}\StringTok{"NA"}\NormalTok{,}\StringTok{"NaN"}\NormalTok{, }\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{))}
\KeywordTok{str}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    54 obs. of  14 variables:
##  $ Ã¯..X                     : num  -75.1 -75.1 -75.1 -75.2 -75.2 ...
##  $ Y                        : num  40 40 40 40 39.9 ...
##  $ OBJECTID                 : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ NEIGHBORHOOD             : Factor w/ 16 levels "Bridesburg Kensington Port Richmond",..: 1 1 1 3 4 3 3 3 3 3 ...
##  $ NAME                     : Factor w/ 54 levels "11th & Dauphin",..: 23 39 44 47 49 17 32 18 27 46 ...
##  $ ADDRESS                  : Factor w/ 53 levels "10th and Chestnut St.",..: 9 4 37 3 11 47 1 8 14 2 ...
##  $ ADDRESS_NOTES            : Factor w/ 16 levels "At Saul High School",..: NA 6 NA NA NA NA NA NA NA NA ...
##  $ DAY                      : Factor w/ 19 levels "1st & 3rd Fri",..: 8 19 13 16 19 13 13 11 12 9 ...
##  $ TIME                     : Factor w/ 27 levels "1-5pm","10am-2pm",..: 22 5 14 27 14 14 7 20 2 23 ...
##  $ MONTHS                   : Factor w/ 43 levels "July - Sept",..: 20 25 26 42 31 15 26 39 39 43 ...
##  $ ACCEPT_SNAP_ACCESS       : Factor w/ 4 levels "Applied","McCanns Farm",..: 3 1 NA NA NA 3 2 3 3 3 ...
##  $ ACCEPT_FMNP              : Factor w/ 2 levels "Applied","Y": 2 1 2 2 2 2 2 2 2 2 ...
##  $ ACCEPT_PHILLY_FOOD_BUCKS_: logi  NA NA NA NA NA NA ...
##  $ MAJOR_BUS_SUBWAY_ROUTES  : Factor w/ 48 levels "12, 40, 57","13 trolley, G",..: 14 17 5 40 36 37 47 36 1 22 ...
\end{verbatim}

\subsection{Variable types}\label{variable-types}

Find out what class each variable in the dataset is

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    54 obs. of  14 variables:
##  $ Ã¯..X                     : num  -75.1 -75.1 -75.1 -75.2 -75.2 ...
##  $ Y                        : num  40 40 40 40 39.9 ...
##  $ OBJECTID                 : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ NEIGHBORHOOD             : Factor w/ 16 levels "Bridesburg Kensington Port Richmond",..: 1 1 1 3 4 3 3 3 3 3 ...
##  $ NAME                     : Factor w/ 54 levels "11th & Dauphin",..: 23 39 44 47 49 17 32 18 27 46 ...
##  $ ADDRESS                  : Factor w/ 53 levels "10th and Chestnut St.",..: 9 4 37 3 11 47 1 8 14 2 ...
##  $ ADDRESS_NOTES            : Factor w/ 16 levels "At Saul High School",..: NA 6 NA NA NA NA NA NA NA NA ...
##  $ DAY                      : Factor w/ 19 levels "1st & 3rd Fri",..: 8 19 13 16 19 13 13 11 12 9 ...
##  $ TIME                     : Factor w/ 27 levels "1-5pm","10am-2pm",..: 22 5 14 27 14 14 7 20 2 23 ...
##  $ MONTHS                   : Factor w/ 43 levels "July - Sept",..: 20 25 26 42 31 15 26 39 39 43 ...
##  $ ACCEPT_SNAP_ACCESS       : Factor w/ 4 levels "Applied","McCanns Farm",..: 3 1 NA NA NA 3 2 3 3 3 ...
##  $ ACCEPT_FMNP              : Factor w/ 2 levels "Applied","Y": 2 1 2 2 2 2 2 2 2 2 ...
##  $ ACCEPT_PHILLY_FOOD_BUCKS_: logi  NA NA NA NA NA NA ...
##  $ MAJOR_BUS_SUBWAY_ROUTES  : Factor w/ 48 levels "12, 40, 57","13 trolley, G",..: 14 17 5 40 36 37 47 36 1 22 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#could also use }
\CommentTok{#lapply(markets, class)}
\end{Highlighting}
\end{Shaded}

why don't we have any character variables? default setting for read.csv
is to import strings as factors to change this, and reimport the dataset
with strings as characters we could run:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"Farmers_Markets.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors =}\NormalTok{ F, }\DataTypeTok{na.strings=}\KeywordTok{c}\NormalTok{(}\StringTok{"NA"}\NormalTok{,}\StringTok{"NaN"}\NormalTok{, }\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{))}
\KeywordTok{str}\NormalTok{(markets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    54 obs. of  14 variables:
##  $ Ã¯..X                     : num  -75.1 -75.1 -75.1 -75.2 -75.2 ...
##  $ Y                        : num  40 40 40 40 39.9 ...
##  $ OBJECTID                 : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ NEIGHBORHOOD             : chr  "Bridesburg Kensington Port Richmond" "Bridesburg Kensington Port Richmond" "Bridesburg Kensington Port Richmond" "Center City" ...
##  $ NAME                     : chr  "Greensgrow Farm Stand" "Norris Square Neighborhood Project" "Powers Park" "Rittenhouse" ...
##  $ ADDRESS                  : chr  "2501 E. Cumberland Ave" "2141 N. Howard St" "Almond and E. Ann St" "18th and Walnut St." ...
##  $ ADDRESS_NOTES            : chr  NA "Between Norris St and Susquehanna Ave" NA NA ...
##  $ DAY                      : chr  "Mon-Sun" "Wed" "Thurs" "Tues & Sat" ...
##  $ TIME                     : chr  "Mon-Fri 10am-5pm, Sat-Sun 10am-4pm " "11am-1pm" "3-7pm" "Tues 10am-2pm, Sat 9am-3pm" ...
##  $ MONTHS                   : chr  "Late May - November" "May - November" "May - November " "Tues- June - November; Sat- Year round " ...
##  $ ACCEPT_SNAP_ACCESS       : chr  "Y" "Applied" NA NA ...
##  $ ACCEPT_FMNP              : chr  "Y" "Applied" "Y" "Y" ...
##  $ ACCEPT_PHILLY_FOOD_BUCKS_: logi  NA NA NA NA NA NA ...
##  $ MAJOR_BUS_SUBWAY_ROUTES  : chr  "25, 39, 43, 89" "3, 39, 89" "15B, 54, 60" "9, 17" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#now all variables containing strings are of class 'character'}
\end{Highlighting}
\end{Shaded}

\subsection{Change class of variable}\label{change-class-of-variable}

What if we want to consider a character variable as a factor? In this
dataset, ``NEIGHBORHOOD'' is the most likely factor variable since it
has discernable levels

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\KeywordTok{class}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD) }\CommentTok{# now it is a factor}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "factor"
\end{verbatim}

Factor variables have levels. Notice that some of these levels are
redundant

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{levels}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Bridesburg Kensington Port Richmond"
##  [2] "Center city"                        
##  [3] "Center City"                        
##  [4] "Center City "                       
##  [5] "Germantown Chestnut Hill"           
##  [6] "Lower Northeast"                    
##  [7] "North"                              
##  [8] "Northeast"                          
##  [9] "Northwest"                          
## [10] "Northwest "                         
## [11] "Olney Oak Lane"                     
## [12] "Roxborough Manayunk"                
## [13] "South"                              
## [14] "Southwest"                          
## [15] "West"                               
## [16] "West "
\end{verbatim}

\subsection{Dealing with inconsistent
values}\label{dealing-with-inconsistent-values}

White space in variable values

\url{https://bookdown.org/lyzhang10/lzhang_r_tips_book/how-to-deal-with-empty-spaces.html}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{help}\NormalTok{(str_trim)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## starting httpd help server ... done
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets <-}\StringTok{ }\NormalTok{markets }\OperatorTok{%>%}\StringTok{ }\CommentTok{#note this saves the changes to the dataframe}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{NEIGHBORHOOD =} \KeywordTok{str_trim}\NormalTok{(NEIGHBORHOOD))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{unique}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Bridesburg Kensington Port Richmond"
##  [2] "Center City"                        
##  [3] "Center city"                        
##  [4] "Germantown Chestnut Hill"           
##  [5] "Lower Northeast"                    
##  [6] "North"                              
##  [7] "Northeast"                          
##  [8] "Northwest"                          
##  [9] "Olney Oak Lane"                     
## [10] "Roxborough Manayunk"                
## [11] "South"                              
## [12] "Southwest"                          
## [13] "West"
\end{verbatim}

\subsection{Capitalization in variable values using
grep}\label{capitalization-in-variable-values-using-grep}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{index <-}\StringTok{ }\KeywordTok{grepl}\NormalTok{(}\StringTok{"city"}\NormalTok{, markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD, }\DataTypeTok{ignore.case =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{#CITY cITY cItY}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD[index] =}\StringTok{ "Center City"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{unique}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Bridesburg Kensington Port Richmond"
##  [2] "Center City"                        
##  [3] "Germantown Chestnut Hill"           
##  [4] "Lower Northeast"                    
##  [5] "North"                              
##  [6] "Northeast"                          
##  [7] "Northwest"                          
##  [8] "Olney Oak Lane"                     
##  [9] "Roxborough Manayunk"                
## [10] "South"                              
## [11] "Southwest"                          
## [12] "West"
\end{verbatim}

Let's check our work

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{levels}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## NULL
\end{verbatim}

Why is this back to being a character? str\_trim and grepl operate on
character vectors so they likely coerce NEIGHBORHOOD to character

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(markets}\OperatorTok{$}\NormalTok{NEIGHBORHOOD) }\CommentTok{#now we are back to meaningful levels}
\end{Highlighting}
\end{Shaded}

\subsection{Reshaping / pivoting data}\label{reshaping-pivoting-data}

Right now our data is in `long' format, if we wanted to organize by
NEIGHBORHOOD and put the data in `wide' format, we could use reshape()
in Base R:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{markets_wide <-}\StringTok{ }\KeywordTok{reshape}\NormalTok{(markets, }\DataTypeTok{idvar =} \StringTok{"NEIGHBORHOOD"}\NormalTok{, }\DataTypeTok{timevar =} \StringTok{"OBJECTID"}\NormalTok{, }\DataTypeTok{direction =} \StringTok{"wide"}\NormalTok{)}
\KeywordTok{View}\NormalTok{(markets_wide)}
\end{Highlighting}
\end{Shaded}

To pivot data, we can use the reshape package and the melt and cast
functions

\subsection{Saving out your cleaned
dataset}\label{saving-out-your-cleaned-dataset}

This is useful so you don't need to repeat each of these steps for
future analysis! Save the script you clean your data in, and save a copy
of the raw data for reference

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.csv}\NormalTok{(markets, }\StringTok{"cleaned_Farmers_Markets.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
